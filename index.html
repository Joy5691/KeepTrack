<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KeepTrack - Expense Tracker</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK v9 Compat -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="spinner"></div>
        <p>Connecting to Firebase...</p>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="screen" style="display: none;">
        <div class="login-container">
            <div class="logo">
                <h1>üí∞ KeepTrack</h1>
                <p>Track your expenses, save better</p>
            </div>
            
            <form id="loginForm" class="auth-form">
                <div class="input-group">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                </div>
                
                <div class="input-group">
                    <input type="password" id="loginPassword" placeholder="Password" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
            
            <p class="auth-switch">
                Don't have an account? <span id="showRegister">Sign up</span>
            </p>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="screen" style="display: none;">
        <div class="login-container">
            <div class="logo">
                <h1>üí∞ KeepTrack</h1>
                <p>Create your account</p>
            </div>
            
            <form id="registerForm" class="auth-form">
                <div class="input-group">
                    <input type="text" id="registerName" placeholder="Full Name" required>
                </div>
                
                <div class="input-group">
                    <input type="email" id="registerEmail" placeholder="Email" required>
                </div>
                
                <div class="input-group">
                    <input type="password" id="registerPassword" placeholder="Password (min 6 chars)" required minlength="6">
                </div>
                
                <button type="submit" class="btn btn-primary">Register</button>
            </form>
            
            <p class="auth-switch">
                Already have an account? <span id="showLogin">Login</span>
            </p>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="mainApp" class="screen" style="display: none;">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="app-title">üí∞ KeepTrack</h1>
                    <p class="user-greeting">Welcome, <span id="userName">User</span></p>
                </div>
                <button id="logoutBtn" class="btn btn-secondary">Logout</button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab active" data-tab="dashboard">
                <span class="tab-icon">üìä</span>
                Dashboard
            </button>
            <button class="tab" data-tab="add">
                <span class="tab-icon">‚ûï</span>
                Add
            </button>
            <button class="tab" data-tab="history">
                <span class="tab-icon">üìù</span>
                History
            </button>
            <button class="tab" data-tab="stats">
                <span class="tab-icon">üìà</span>
                Stats
            </button>
        </nav>

        <!-- Tab Contents -->
        <main class="tab-container">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="cards-grid">
                    <!-- Balance Card -->
                    <div class="stat-card balance-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-content">
                            <p class="stat-label">Total Balance</p>
                            <h2 id="totalBalance" class="stat-value">‡ß≥0.00</h2>
                        </div>
                    </div>

                    <!-- Income Card -->
                    <div class="stat-card income-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-content">
                            <p class="stat-label">Total Income</p>
                            <h2 id="totalIncome" class="stat-value income">+‡ß≥0.00</h2>
                        </div>
                    </div>

                    <!-- Expense Card -->
                    <div class="stat-card expense-card">
                        <div class="stat-icon">üìâ</div>
                        <div class="stat-content">
                            <p class="stat-label">Total Expense</p>
                            <h2 id="totalExpense" class="stat-value expense">-‡ß≥0.00</h2>
                        </div>
                    </div>
                </div>

                <!-- Today's Activity -->
                <div class="section-card">
                    <h3 class="section-title">Today's Activity</h3>
                    <div class="activity-grid">
                        <div class="activity-item">
                            <span class="activity-label">Today's Income</span>
                            <span id="todayIncome" class="activity-value income">+‡ß≥0.00</span>
                        </div>
                        <div class="activity-item">
                            <span class="activity-label">Today's Expense</span>
                            <span id="todayExpense" class="activity-value expense">-‡ß≥0.00</span>
                        </div>
                        <div class="activity-item">
                            <span class="activity-label">Month Savings</span>
                            <span id="monthSavings" class="activity-value">‡ß≥0.00</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="section-card">
                    <h3 class="section-title">Recent Transactions</h3>
                    <div id="recentList" class="transactions-list">
                        <p class="empty-state">No transactions yet. Add your first transaction!</p>
                    </div>
                </div>
            </div>

            <!-- Add Transaction Tab -->
            <div id="add" class="tab-content">
                <div class="section-card">
                    <h3 class="section-title">Add Transaction</h3>
                    
                    <form id="addForm" class="transaction-form">
                        <!-- Type Selection -->
                        <div class="type-selector">
                            <button type="button" id="incomeBtn" class="type-btn active">
                                <span class="type-icon">üìà</span>
                                Income
                            </button>
                            <button type="button" id="expenseBtn" class="type-btn">
                                <span class="type-icon">üìâ</span>
                                Expense
                            </button>
                        </div>

                        <input type="hidden" id="transactionType" value="income">

                        <div class="form-grid">
                            <div class="input-group">
                                <label for="amount">Amount (‡ß≥)</label>
                                <input type="number" id="amount" placeholder="0.00" step="0.01" min="0" required>
                            </div>

                            <div class="input-group">
                                <label for="category">Category</label>
                                <select id="category" required>
                                    <option value="Salary">Salary</option>
                                    <option value="Freelance">Freelance</option>
                                    <option value="Business">Business</option>
                                    <option value="Investment">Investment</option>
                                    <option value="Bonus">Bonus</option>
                                    <option value="Gift">Gift</option>
                                    <option value="Other Income">Other Income</option>
                                </select>
                            </div>

                            <div class="input-group full-width">
                                <label for="description">Description</label>
                                <input type="text" id="description" placeholder="Optional description">
                            </div>

                            <div class="input-group">
                                <label for="date">Date</label>
                                <input type="date" id="date" required>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            Add Transaction
                        </button>
                    </form>
                </div>
            </div>

            <!-- History Tab -->
            <div id="history" class="tab-content">
                <div class="section-card">
                    <h3 class="section-title">Transaction History</h3>
                    <div id="transactionHistory" class="transactions-list">
                        <p class="empty-state">No transaction history</p>
                    </div>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div id="stats" class="tab-content">
                <div class="stats-grid">
                    <!-- Income Breakdown -->
                    <div class="section-card">
                        <h3 class="section-title">Income Breakdown</h3>
                        <div id="incomeBreakdown" class="breakdown-list">
                            <p class="empty-state">No income data</p>
                        </div>
                    </div>

                    <!-- Expense Breakdown -->
                    <div class="section-card">
                        <h3 class="section-title">Expense Breakdown</h3>
                        <div id="expenseBreakdown" class="breakdown-list">
                            <p class="empty-state">No expense data</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCp3ZOd_noD5vEIngZs13n_CMWaF_95z98",
            authDomain: "keeptrack-7ecc0.firebaseapp.com",
            projectId: "keeptrack-7ecc0",
            storageBucket: "keeptrack-7ecc0.firebasestorage.app",
            messagingSenderId: "50588338908",
            appId: "1:50588338908:web:55742e6d5ec1999d224219",
            measurementId: "G-64DPZ24NFN"
        };

        // Global variables (declare here, will be used in app.js)
        let auth = null;
        let db = null;
        let firebaseInitialized = false;

        // Initialize Firebase
        function initializeFirebase() {
            try {
                console.log("Initializing Firebase...");
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                firebaseInitialized = true;
                console.log("‚úÖ Firebase initialized successfully!");
                
                // Hide loading and check auth state
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loadingScreen');
                    if (loadingScreen) {
                        loadingScreen.style.display = 'none';
                    }
                    checkAuthState();
                }, 1000);
            } catch (error) {
                console.error("Firebase initialization error:", error);
                // Hide loading and show login screen
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loadingScreen');
                    if (loadingScreen) {
                        loadingScreen.style.display = 'none';
                    }
                    const loginScreen = document.getElementById('loginScreen');
                    if (loginScreen) {
                        loginScreen.style.display = 'flex';
                    }
                }, 500);
                showToast('Running in offline mode', 'info');
            }
        }

        function checkAuthState() {
            if (!auth) {
                const loginScreen = document.getElementById('loginScreen');
                if (loginScreen) {
                    loginScreen.style.display = 'flex';
                }
                return;
            }

            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log("‚úÖ User logged in:", user.email);
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('registerScreen').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'flex';
                    document.getElementById('userName').textContent = user.displayName || user.email;
                    
                    // Load user data after showing dashboard
                    if (window.loadUserData) {
                        window.loadUserData();
                    }
                } else {
                    console.log("No user logged in");
                    document.getElementById('loginScreen').style.display = 'flex';
                    document.getElementById('mainApp').style.display = 'none';
                }
            });
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üì± Page loaded, initializing Firebase...");
            initializeFirebase();
        });
    </script>

    <!-- Main App Logic -->
    <script src="app.js"></script>

</body>
</html>
